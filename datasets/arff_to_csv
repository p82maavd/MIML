
import numpy as np

def arff_to_csv(file,delimiter="'"):
    f=open(file)
    csv = open(file[:-5]+".csv","w")
    attrib = []
    flag = 0
    for line in f:

            #Comprobamos que la cadena no contenga espacios en blanco a la izquierda ni que sea vacía
            line = line.lstrip()
            if line == "":
                continue


            if line.startswith("@"):
                if not (line.startswith("%")):
                    if line.startswith("@relation"):
                        #arff.setName(line[line.find(" ")+1:])
                        pass
                    elif line.startswith("@attribute bag relational"):
                        flag = 1
                    elif line.startswith("@end bag"):
                        flag = 0
                    elif flag == 1:
                        if line.startswith("@attribute"):

                            attrib.append(line[line.find(" ")+1:line.find(" ",line.find(" ")+1)])


            else:
                #Eliminanos el salto de línea del final de la cadena
                line = line.strip("\n")

                #Asumimos que el primer elemento de cada instancia es el identificador de la bolsa
                key = line[0:line.find(",")]
                #print("Key: ", key)

                #Empiezan los datos de la bolsa cuando encontremos la primera '"' y terminan con la segunda '"'
                line = line[line.find(delimiter)+1:]
                #TODO: Testeo con toy.arff
                values = line[:line.find(delimiter,line.find(delimiter,line.find(delimiter)))]
                #Separamos los valores por instancias de la bolsa
                values = values.split("\\n")
                #print("Values ", values)

                #El resto de la cadena se trata de las etiquetas
                labels = line[line.find(delimiter,line.find(delimiter,line.find(delimiter)))+2:]
                #arff.setNumberLabels(len(labels.split(",")))
                #print("Labels: ", labels)

                valueslist = []
                for v in values:
                    csv.write(key + "," + v + "," + labels + "\n")
                #arff.addBag(key,np.array(valueslist),np.array([int(i) for i in labels.split(',')]))
                    #TODO: añadir gestion atributos
                    #TODO: quizas separar en funciones para data y para atributos
                    #TODO: incluso diccionario aparte para stats

    #arff.setAttributes(attrib)
    #return arff
arff_to_csv("toy.arff","\"")